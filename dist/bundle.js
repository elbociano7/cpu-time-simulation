!function(s,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CpuTimeSimulation=e():s.CpuTimeSimulation=e()}(self,(()=>(()=>{"use strict";var s,e={d:(s,t)=>{for(var i in t)e.o(t,i)&&!e.o(s,i)&&Object.defineProperty(s,i,{enumerable:!0,get:t[i]})},o:(s,e)=>Object.prototype.hasOwnProperty.call(s,e),r:s=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{FCFS:()=>u,FCLS:()=>a,ProcessingUnit:()=>c,Simulation:()=>o}),function(s){s[s.BUSY=0]="BUSY",s[s.IDLE=1]="IDLE",s[s.ERROR=2]="ERROR"}(s||(s={}));const i="[0m",r={customLogger:console.log,prefix:"",setPrefix(s){this.prefix=s},log(s){this.customLogger(`[33m[${this.prefix}]${i} [90m${s}${i}`)},logHeader(s){this.customLogger(`########## ${s} ##########`)}};class o{constructor(s,e,t=0){this.processList=[],this.enableLogging=!1,this.processingUnit=s,this.tickTime=e,this.maxTicks=t}setProcess(s,e){this.processList.push({arrivalTime:e,process:s})}run(){if(this.tickTime<=0)for(;this.tick(),!(this.maxTicks>0&&this.processingUnit.time>=this.maxTicks););else this.interval=setInterval((()=>{this.tick(),this.maxTicks>0&&this.processingUnit.time>=this.maxTicks&&(r.logHeader(`Max ticks reached: ${this.maxTicks}`),clearInterval(this.interval))}),this.tickTime)}stop(){clearInterval(this.interval)}tick(){this.processList[this.processingUnit.time],this.processList.forEach((s=>{s.arrivalTime===this.processingUnit.time&&this.processingUnit.addProcess(s.process)})),this.enableLogging&&(r.logHeader(`Tick: ${this.processingUnit.time}`),r.setPrefix(this.processingUnit.time.toString())),this.processingUnit.tick()===s.IDLE&&(this.log("Processing unit is going idle cycle"),0!==this.maxTicks||this.processList.some((s=>s.arrivalTime>=this.processingUnit.time))||0!==this.processingUnit.dispatcher.getQueue().length||(this.maxTicks=this.processingUnit.time,this.log(`Stopping after ${this.maxTicks-1} ticks`)))}log(s){this.enableLogging&&r.log(s)}}class n extends Error{}class c{constructor(s,e,t,i,r){this.time=0,this.readQueue=[],this.hits=[],this.misses=[],this.currentProcess=null,this.enableLogging=!1,this.onTick=s=>{},this.onProcessEnd=(s,e)=>{},this.dispatcher=s,this.pra=e,this.mmu=t,this.memory=i,this.storage=r}runProcess(s){if(this.enableLogging&&r.log(`Running process: '${s.name}'`),null!==this.currentProcess)throw new n("Another process is already running");this.currentProcess=s,this.currentProcess.run(this.getRuntimeData())}stopProcess(){var s,e;if(this.enableLogging&&r.log(`Stopping process: ${null===(s=this.currentProcess)||void 0===s?void 0:s.name}`),null===this.currentProcess)throw new n("Attempted to stop null process");null===(e=this.currentProcess)||void 0===e||e.stop(this.getRuntimeData()),this.dispatcher.stopProcess(this.currentProcess),this.currentProcess=null}dropProcess(){var s;if(this.enableLogging&&r.log(`Dropping process: '${null===(s=this.currentProcess)||void 0===s?void 0:s.name}'`),null===this.currentProcess)throw new n("Attempted to drop null process");this.dispatcher.dropProcess(this.currentProcess),this.currentProcess=null}addProcess(s){this.dispatcher.addToQueue(s)}readData(s,e=()=>{}){const t=this.mmu.translate(s);if(!1===t){const t=this.pra.onMiss(this.mmu,s);this.log(`Memory miss at address {yellow-fg}0x${s.toString(16)}{/yellow-fg}; frame: {yellow-fg}${t}{/yellow-fg}`);const i=this.replaceFrame(t,s);e(this.memory.read(i)),this.misses.push(s)}else{e(this.memory.read(t));const i=this.pra.onHit(this.mmu,s);this.log(`Memory hit at address {green-fg}0x${s.toString(16)}{/green-fg}; frame: {green-fg}${i}{/green-fg}`),this.hits.push(s)}this.lastRead=s}replaceFrame(s,e){const{page:t,offset:i}=this.mmu.pageTable.getPageAddress(e);this.mmu.pageTable.assignPageToFrame(t,s);const r=this.mmu.pageTable.frameSize;return((s,e,t,i,r)=>{var o;for(let n=0;n<r;n++)e.set(i+n,null!==(o=s.get(t+n))&&void 0!==o?o:0)})(this.storage.data,this.memory.memory,t*r,s*r,r),s*r+i}tick(){var e;if(this.lastRead=void 0,this.readQueue.length>0){const s=this.readQueue.shift();"object"==typeof s?this.readData(s.address,s.handler):this.readData(s)}if(this.dispatcher.tick(this),this.time++,this.onTick(this),!this.currentProcess)return s.IDLE;this.log(`Ticking process: '${this.currentProcess.name}'`);const t=this.currentProcess.tick(this.getRuntimeData());return null!==t&&this.log(`Process: '${null===(e=this.currentProcess)||void 0===e?void 0:e.name}' returned with code ${t}`),0===t&&(this.dispatcher.dropProcess(this.currentProcess),this.onProcessEnd(this.currentProcess,this),this.dropProcess()),s.BUSY}getRuntimeData(){return{tick:this.time}}log(s){this.enableLogging&&r.log(s)}}class h{}class u extends h{constructor(){super(...arguments),this.queue=[],this.busy=!1}addToQueue(s){this.queue.push(s)}tick(s){if(!this.busy){const e=this.queue.shift();e&&(this.busy=!0,s.runProcess(e))}}dropProcess(s){this.busy=!1}stopProcess(s){this.queue.push(s),this.busy=!1}getQueue(){return this.queue}}class a extends h{constructor(){super(...arguments),this.queue=[],this.busy=!1}addToQueue(s){this.queue.push(s)}tick(s){if(!this.busy){const e=this.queue.pop();e&&(this.busy=!0,s.runProcess(e))}}dropProcess(s){this.busy=!1}stopProcess(s){this.queue.push(s),this.busy=!1}getQueue(){return this.queue}}return t})()));
//# sourceMappingURL=bundle.js.map